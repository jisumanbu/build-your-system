---
description: "[Organize] 每日回顾 - 分发 + 复盘 + 规划"
argument-hint: "[YYYY-MM-DD]"
---

# 每日回顾

**参数**：日期，默认今天。当前目录是 Vault。

## 前置数据

!`python3 "${CLAUDE_PLUGIN_ROOT}/scripts/analyze-cc-activity.py" $ARGUMENTS`

上面是当日 Claude Code 活动数据（时间线、时间投入、领域分布）。Phase 2 复盘时使用。

---

## Phase 1: 分发

### 1.1 读取待分发内容

**依次处理**：
1. 读取 `00-Inbox/{日期}.md`（日志），识别可提取项
2. 读取 `00-Inbox/capture.md`（inbox），解析条目

### 1.2 识别规则

参考 capture-rules skill

**项目归属识别**（新增）：
- 格式：`@项目名` 或 `[[项目名]]`
- 验证：检查 `10-Projects/` 下是否存在该项目
- 不存在时：询问是否创建

### 1.3 Someday 智能建议

**建议进入 someday 的条件**（满足全部）：
1. 领域不匹配主线（读取 `60-Memory/profile.md` 获取 #indie, #media 等）
2. 无项目关联（不在 10-Projects）
3. 无明确截止日期或 > 30 天
4. 关键词触发：以后再说、将来、有空、改天、也许、想研究、感兴趣

**建议时显示原因**：
```
1. 研究 Rust 语言 #learning → 建议 someday ⚠️
   原因：#learning 与主线不符；关键词"以后"
```

### 1.4 默认分发规则

| 类型 | 目标 |
|------|------|
| #task | `50-GTD/active.md` 追加 |
| #task + 建议延后 | `50-GTD/someday.md` 追加（需确认）|
| #waiting | `50-GTD/waiting.md` 追加 |
| #topic | `20-Areas/media/topics/{名}.md` 新建 |
| #idea | `20-Areas/indie/ideas/{名}.md` 新建 |
| #record | `00-Inbox/{日期}.md` 追加 |
| #insight | `60-Memory/patterns.md` 追加 |

**项目关联处理**：
- `@项目名` 转换为 `[[项目名]]` wiki-link
- 任务格式：`- [ ] 任务描述 [[项目名]] #领域 📅 {明天}`

**追加规则**：新内容插入到文件已有内容**之前**（倒序）

### 1.5 交互

⭐ 暂停等用户回答

展示识别结果后询问：
```
识别结果：
1. 完成导出功能 → active.md [[物流系统]] #outsourcing
2. 研究 Rust 语言 → 建议 someday ⚠️ (与主线不符)
3. 等客户回复 → waiting.md

如何处理？
1. ✅ 全部分发（接受建议）
2. 🔍 逐条确认
3. ⏭️ 跳过
```

**新项目创建**（当 @项目名 不存在时）：
```
⚠️ 项目 "新产品" 不存在

1. ✅ 创建项目 "新产品"
2. 🔗 关联到现有项目
3. ➖ 不关联项目
```

创建项目时使用模板：
```yaml
---
status: active
created: {日期}
area: {从任务标签推断}
---

# {项目名}

## 目标

（待填写）
```

---

## Phase 2: 复盘（GRAI + 4Fs 融合）

### 2.1 归档已完成任务

**归档逻辑**：
1. 读取 `50-GTD/active.md`
2. 识别所有 `[x]` 开头的任务（正则：`^- \[x\]`）
3. 对每个已完成任务：
   - 提取任务描述、标签、项目关联、子任务
   - 添加完成日期：`✅ {日期}`
   - 移动到 `50-GTD/done.md` 对应月份区域
   - 从 active.md 删除（包括 MIT 区域的引用）

**done.md 格式**：
```markdown
# 已完成任务归档

## 2026-01

- [x] 任务描述 [[项目名]] ✅ 2026-01-11 #标签
  - 子任务

---

## 2025-12
...
```

**插入规则**：
- 按月份分组（`## YYYY-MM`）
- 新任务插入到当月组**最前面**（倒序）
- 月份区域不存在则创建

### 2.2 统计项目进度

**读取项目状态**：
- 扫描 `10-Projects/*.md` 和 `10-Projects/*/README.md`
- 解析 frontmatter 获取 status
- 统计任务按项目归属

**展示项目进度表**：
```
### 🎯 项目进度
| 项目 | 今日任务 | 完成 | 状态 |
|------|----------|------|------|
| [[物流系统]] | 3 | 2 | active |
| [[教程视频]] | 1 | 0 | paused |

📊 活跃项目：2 | 暂停：1 | 本周完成：0
```

### 2.3 展示回顾

整合前置活动数据 + MIT + 项目进度：

```
=== {日期} 回顾 ===

📋 已归档: X 条任务
📊 活动时段：{开始} - {结束}
💬 消息总数：N 条

### 🎯 项目进度
| 项目 | 今日任务 | 完成 | 状态 |
|------|----------|------|------|
| [[物流系统]] | 3 | 2 | active |

📝 活动流水：
| 时间  | Session          | 消息数 | 活动摘要                    | 关联 MIT                    |
|-------|------------------|-----------------------------|-----------------------------|
| 12:04 | 复刻系统教程     | 20 | 启动项目规划                | Obsidian + Claude Code 教程 |
| 16:41 | flomo导入        | 12 | 数据导入研究                | （计划外）                  |

🎯 MIT vs 实际：
| MIT 计划 | 状态 | 实际投入 |
|----------|------|----------|
| ... | ✅/⏸️ | 来自前置数据 |

**完成率**：N/M

📈 计划外产出：
| 活动            | 时间    | 价值评估   |
|-----------------|---------|------------|
| flomo导入研究   | 30min   | 高价值产出 |

🔍 偏差分析：优先级变化 - 投入到更紧急的创作任务（高价值产出）
```

### 2.4 询问感受

⭐ 暂停等用户回答

```
今天感觉怎么样？
1. 😊 挺好的，完成了想做的事
2. 😐 一般，有些事没做完
3. 😔 不太好，状态不佳
4. 🔥 超棒，特别有成就感
5. 😫 很累/很焦虑
6. 其他（说说看）
```

### 2.5 引导分析

根据感受针对性引导

### 2.6 提取洞察

⭐ 暂停等用户回答，写入 `60-Memory/patterns.md`

**晚间附加**（>=22:00）：睡前三问

### 2.7 保存复盘到日志（自动）

**保存位置**：`00-Inbox/{日期}.md`

**保存前检查**：
1. 读取日志文件
2. 检查是否已存在 `## 复盘` 区块
3. 如已存在：询问「今天已有复盘记录，是否覆盖？」
   - 1. 覆盖
   - 2. 追加新版本（标记时间）
   - 3. 跳过

**保存格式**（追加到日志末尾）：
```markdown
---

## 复盘

> 由 /o-review 自动生成于 {HH:MM}

### 📊 活动数据
- 活动时段：{start} - {end}
- 消息总数：{N} 条

### 🎯 MIT 完成情况
| MIT 计划 | 状态 | 实际投入 |
|----------|------|----------|
| {任务1} | ✅/⏸️ | {时间} |

完成率：{N/M}

### 🎯 项目进度
| 项目 | 今日 | 完成 |
|------|------|------|
| [[项目名]] | X | Y |

### 💭 感受
{用户选择或自述}

### 🔍 偏差分析
{AI 分析内容}

### 💡 今日洞察
- {洞察1}
- {洞察2}
```

---

## Phase 3: 明日规划

### 3.1 展示可选任务

按项目分组展示 active.md 中的待办任务：

```
## Phase 3: 明日规划

可选任务（按项目分组）：

### [[物流系统]] (active)
1. [ ] 完成导出功能文档
2. [ ] 修复日期格式 bug

### [[教程视频]] (paused ⚠️)
3. [ ] 剪辑第三期

### 无项目
4. [ ] 整理本周笔记

请选择 1-3 个作为明日 MIT（输入序号，如 1,2）：
```

### 3.2 更新 MIT

⭐ 暂停等用户输入序号

更新 `50-GTD/active.md` 的"今日重点"部分：
```markdown
## 今日重点 (MIT) - {明天 MM-DD}

- [ ] 选中的任务1 [[项目名]] ⏫
- [ ] 选中的任务2 🔼
```

**限制**：最多选择 3 个，超过则提示重新选择

---

## 结束

简要总结：
```
✅ 每日回顾完成！

📥 Inbox：已处理 X 条，剩余 Y 条
📋 任务：已归档 X 条，活跃 Y 条
📝 复盘：已保存到 00-Inbox/{日期}.md

明日 MIT：
1. {任务1}
2. {任务2}
3. {任务3}
```
